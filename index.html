<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»æ°—è¨­è¨ˆãƒã‚¹ã‚¿ãƒ¼ãƒ»ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã€V5.0 ç©¶æ¥µçµ±åˆç‰ˆã€‘</title>
    <style>
        :root { 
            --primary: #0f172a; --accent: #2563eb; --danger: #e11d48; 
            --warning: #d97706; --success: #059669; --bg: #f8fafc; 
            --ground: #16a34a; --spec-bg: #f1f5f9;
        }
        body { font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #334155; font-size: 13px; line-height: 1.4; }
        .container { max-width: 1600px; margin: auto; display: grid; grid-template-columns: 550px 1fr; gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; height: fit-content; }
        
        .tab-bar { max-width: 1600px; margin: 0 auto 10px auto; display: flex; gap: 5px; }
        .tab-btn { padding: 12px 24px; border: 1px solid #e2e8f0; border-bottom: none; background: #e2e8f0; border-radius: 12px 12px 0 0; cursor: pointer; font-weight: bold; color: #64748b; transition: 0.3s; }
        .tab-btn.active { background: white; color: var(--accent); border-top: 3px solid var(--accent); }

        h1 { font-size: 1.2rem; margin: 0 0 15px 0; display: flex; align-items: center; gap: 8px; color: var(--primary); border-bottom: 2px solid #e2e8f0; padding-bottom: 8px; }
        h2 { font-size: 0.8rem; margin: 15px 0 8px 0; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; border-left: 3px solid var(--accent); padding-left: 8px; }
        
        .input-group { background: #f1f5f9; padding: 12px; border-radius: 8px; margin-bottom: 12px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        label { display: block; font-size: 0.7rem; font-weight: 700; margin-bottom: 4px; color: #475569; }
        select, input { width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; font-size: 0.9rem; }

        .mode-selector { display: flex; gap: 2px; background: #e2e8f0; padding: 2px; border-radius: 6px; margin-bottom: 8px; }
        .mode-btn { flex: 1; border: none; background: none; padding: 6px; cursor: pointer; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }
        .mode-btn.active { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); color: var(--accent); }

        .status-banner { padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; font-size: 1.2rem; margin-bottom: 20px; border: 2px solid transparent; }
        .safe { background: #ecfdf5; color: var(--success); border-color: var(--success); }
        .warn { background: #fffbeb; color: var(--warning); border-color: var(--warning); }
        .danger { background: #fff1f2; color: var(--danger); border-color: var(--danger); }

        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: #fff; border: 1px solid #e2e8f0; padding: 15px; border-radius: 10px; position: relative; overflow: hidden; }
        .stat-card::before { content: ""; position: absolute; left: 0; top: 0; height: 100%; width: 4px; background: var(--accent); }
        .stat-card.fill::before { background: #8b5cf6; }
        .stat-card.ground::before { background: var(--ground); }
        .stat-value { font-size: 1.4rem; font-weight: 800; display: block; color: var(--primary); margin-bottom: 4px; }
        .stat-label { font-size: 0.7rem; color: #64748b; font-weight: bold; }

        .evidence-box { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-top: 10px; }
        .advice-item { margin-bottom: 12px; padding: 10px; border-left: 4px solid #cbd5e1; background: white; border-radius: 0 6px 6px 0; }
        .advice-item.danger-border { border-left-color: var(--danger); }
        .advice-item.warn-border { border-left-color: var(--warning); }
        .advice-header { font-weight: bold; color: var(--primary); display: flex; align-items: center; gap: 5px; margin-bottom: 5px; }
        .action-needed { color: var(--accent); font-weight: 800; font-size: 0.9rem; display: block; background: #eff6ff; padding: 5px; border-radius: 4px; }

        .formula-box { font-family: 'Consolas', 'Monaco', 'Courier New', monospace; background: #1e293b; color: #f1f5f9; padding: 15px; border-radius: 8px; font-size: 0.85rem; line-height: 1.8; margin-top: 10px; border-left: 5px solid var(--accent); white-space: pre-wrap; }
        .formula-box b { color: #38bdf8; }

        table.spec-table { width: 100%; border-collapse: collapse; font-size: 0.75rem; margin-bottom: 25px; border: 1px solid #e2e8f0; background: white; }
        table.spec-table th, table.spec-table td { border: 1px solid #e2e8f0; padding: 8px; text-align: left; }
        table.spec-table th { background: #f1f5f9; font-weight: bold; color: var(--primary); }
        .spec-item h3 { font-size: 1.1rem; color: var(--accent); border-bottom: 2px solid var(--accent); padding-bottom: 5px; margin-top: 30px; }
        .summary-box { background: #eff6ff; border: 1px solid var(--accent); padding: 15px; border-radius: 8px; margin-top: 20px; }
        .summary-box h4 { margin: 0 0 10px 0; color: var(--accent); font-size: 1rem; }
        .summary-box p { font-size: 0.85rem; margin: 5px 0; }

        .btn-print { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 10px; }

        @media print {
            .tab-bar, .card:first-child, .btn-print { display: none !important; }
            #calc-view { display: block !important; }
            #spec-view { display: block !important; page-break-before: always; }
            .container { display: block; }
        }
    </style>
</head>
<body>

<div class="tab-bar">
    <button class="tab-btn active" id="tab-branch" onclick="switchTab('branch')">âš¡ è¨­è¨ˆè¨ˆç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</button>
    <button class="tab-btn" id="tab-spec" onclick="switchTab('spec')">ğŸ“˜ æŠ€è¡“ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</button>
</div>

<div id="calc-view" class="container">
    <!-- è¨­å®šãƒ‘ãƒãƒ« -->
    <div class="card">
        <h1>âš™ï¸ è¨­è¨ˆæ¡ä»¶è¨­å®š</h1>
        
        <h2>1. è² è·ç¨®åˆ¥ãƒ»é›»æºæ¡ä»¶</h2>
        <div class="input-group">
            <label>è² è·ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
            <div class="mode-selector">
                <button class="mode-btn active" id="load-gen" onclick="setLoadType('general')">ä¸€èˆ¬è² è·</button>
                <button class="mode-btn" id="load-mot" onclick="setLoadType('motor')">é›»å‹•æ©Ÿè² è·</button>
            </div>

            <label style="margin-top:10px;">é…ç·šæ–¹å¼</label>
            <select id="sys-type" onchange="calculate()"></select>
            
            <div class="grid-2" style="margin-top:10px;">
                <div>
                    <label>å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰</label>
                    <div class="mode-selector">
                        <button class="mode-btn" id="btn-W" onclick="setMode('W')">W</button>
                        <button class="mode-btn active" id="btn-kW" onclick="setMode('kW')">kW</button>
                        <button class="mode-btn" id="btn-A" onclick="setMode('A')">A</button>
                    </div>
                </div>
                <div>
                    <label>è² è·å€¤</label>
                    <input type="number" id="main-input" value="5.5" step="0.1" oninput="calculate()">
                </div>
            </div>
            <label style="margin-top:10px;">åŠ›ç‡ (cos Ï†) : <span id="val-pf">90</span>%</label>
            <input type="range" id="pf-percent" min="50" max="100" step="1" value="90" oninput="calculate()">
        </div>

        <h2>2. é›»ç·šãƒ»ã‚±ãƒ¼ãƒ–ãƒ«é¸å®š (å…¨ç¨®ç¶²ç¾…)</h2>
        <div class="input-group">
            <label>é›»ç·šç¨®åˆ¥</label>
            <select id="wire-cat" onchange="updateSizes()"></select>
            
            <div class="grid-2" style="margin-top:8px;">
                <div>
                    <label>ã‚µã‚¤ã‚º</label>
                    <select id="wire-size" onchange="calculate()"></select>
                </div>
                <div>
                    <label>ä¸¦åˆ—æ•°</label>
                    <select id="parallel-n" onchange="calculate()">
                        <option value="1">1 (å˜ç‹¬)</option>
                        <option value="2">2æœ¬ä¸¦åˆ—</option>
                        <option value="3">3æœ¬ä¸¦åˆ—</option>
                    </select>
                </div>
            </div>
            
            <div class="grid-2" style="margin-top:10px;">
                <div>
                    <label>å‘¨å›²æ¸©åº¦ (â„ƒ)</label>
                    <select id="temp" onchange="calculate()">
                        <option value="30">30â„ƒä»¥ä¸‹</option>
                        <option value="35">35â„ƒ</option>
                        <option value="40" selected>40â„ƒ</option>
                        <option value="45">45â„ƒ</option>
                        <option value="50">50â„ƒ</option>
                    </select>
                </div>
                <div>
                    <label>ç®¡å†…ç·šæœ¬æ•° (æ¸›å°‘ä¿‚æ•°ç”¨)</label>
                    <input type="number" id="wire-count" value="3" min="1" max="50" oninput="calculate()">
                </div>
            </div>

            <div style="margin-top:10px;">
                <label>é…ç·šé•· (m) : <span id="val-length">30</span>m</label>
                <input type="range" id="length-range" min="1" max="500" value="30" oninput="syncLength(this.value, 'range')">
                <input type="number" id="length-num" min="1" max="500" value="30" style="margin-top:5px;" oninput="syncLength(this.value, 'num')">
            </div>
        </div>

        <h2>3. é…ç®¡ãƒ»é®æ–­å™¨</h2>
        <div class="input-group">
            <div class="grid-2">
                <div>
                    <label>ç®¡ç¨®åˆ¥</label>
                    <select id="conduit-cat" onchange="updateConduitSizes()"></select>
                </div>
                <div>
                    <label>å‘¼ã³å¾„</label>
                    <select id="conduit-size" onchange="calculate()"></select>
                </div>
            </div>
            <label style="margin-top:10px;">é®æ–­å™¨å®šæ ¼ (AT)</label>
            <select id="breaker-at" onchange="calculate()"></select>
        </div>

        <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ è¨­è¨ˆè¨ˆç®—æ›¸ã‚’å‡ºåŠ›</button>
    </div>

    <!-- çµæœãƒ‘ãƒãƒ« -->
    <div class="card">
        <h1>ğŸ“Š è¨ˆç®—ãƒ»åˆ¤å®šçµæœ</h1>
        <div id="status-banner" class="status-banner">åˆ¤å®šä¸­...</div>

        <div class="result-grid">
            <div class="stat-card"><span class="stat-label">è² è·é›»æµ (I)</span><span class="stat-value" id="res-calc-a">0.00 A</span></div>
            <div class="stat-card"><span class="stat-label">è£œæ­£å¾Œè¨±å®¹é›»æµ (Iz)</span><span class="stat-value" id="res-limit-a">0.0 A</span></div>
            <div class="stat-card"><span class="stat-label">é›»åœ§é™ä¸‹ç‡ (Î”V)</span><span class="stat-value" id="res-v-rate">0.0 %</span></div>
            <div class="stat-card fill"><span class="stat-label">é…ç®¡å æœ‰ç‡ (32%ä»¥ä¸‹)</span><span class="stat-value" id="res-fill-rate">0.0 %</span></div>
            <div class="stat-card ground"><span class="stat-label">æ¥åœ°ç·šã‚µã‚¤ã‚º</span><span class="stat-value" id="res-ground-size">-</span></div>
            <div class="stat-card"><span class="stat-label">æ¸›å°‘ä¿‚æ•°(åˆè¨ˆ)</span><span class="stat-value" id="res-k-total">0.00</span></div>
        </div>

        <div class="evidence-box">
            <h2>ğŸ’¡ åˆ¤å®šã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ãƒ»ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h2>
            <div id="advice-list"></div>
            <h2 style="margin-top:20px;">ğŸ§® è¨ˆç®—ãƒ—ãƒ­ã‚»ã‚¹è©³ç´°ï¼ˆæ•°å€¤æ ¹æ‹ ï¼‰</h2>
            <div id="formula-process" class="formula-box"></div>
        </div>
    </div>
</div>

<!-- æŠ€è¡“ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚¿ãƒ– -->
<div id="spec-view" class="card" style="display:none; margin: 20px auto; max-width: 1400px;">
    <h1>ğŸ“˜ JISè¦æ ¼ãƒ»å†…ç·šè¦ç¨‹ï¼ˆJEAC 8001ï¼‰è¨­è¨ˆåŸºæº–ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</h1>
    
    <div class="spec-item">
        <h3>1. é›»ç·šãƒ»ã‚±ãƒ¼ãƒ–ãƒ«ã®ç¨®é¡ã¨JISè¦æ ¼ãƒ»ç‰¹æ€§ (æ‹¡å……ç‰ˆ)</h3>
        <table class="spec-table">
            <thead>
                <tr><th>ç·šç¨®åç§° (ã‚¨ã‚³åç§°)</th><th>JISè¦æ ¼</th><th>ç”¨é€”</th><th>é•·æ‰€ãƒ»ãƒ¡ãƒªãƒƒãƒˆ</th><th>çŸ­æ‰€ãƒ»æ³¨æ„ç‚¹</th></tr>
            </thead>
            <tbody>
                <tr><td>IV (EM-IE)</td><td>JIS C 3307</td><td>ä¸€èˆ¬å±‹å†…é…ç·šã€åˆ¶å¾¡ç›¤</td><td>å®‰ä¾¡ã€æ‘©æ“¦ãŒå°‘ãªãé…ç®¡æŒ¿å…¥ãŒå®¹æ˜“</td><td>ã‚·ãƒ¼ã‚¹ãŒãªã„ãŸã‚éœ²å‡ºä¸å¯ã€è€ç†±30â„ƒ(IEã¯75â„ƒ)</td></tr>
                <tr><td>HIV (EM-IC)</td><td>JIS C 3317</td><td>æ¶ˆé˜²è¨­å‚™ã€éå¸¸ç…§æ˜</td><td>è€ç†±75â„ƒã¨é«˜ãã€IVã‚ˆã‚Šè¨±å®¹é›»æµãŒå¤§</td><td>IVã«æ¯”ã¹é«˜ä¾¡ã€åŒã˜ãå˜ä½“éœ²å‡ºä¸å¯</td></tr>
                <tr><td>CV (EM-CE)</td><td>JIS C 3605</td><td>å‹•åŠ›å¹¹ç·šã€ä¸€èˆ¬å¹¹ç·š</td><td>çµ¶ç¸ä½“(æ¶æ©‹PE)ãŒç†±ã«å¼·ãã€é«˜è¨±å®¹é›»æµ</td><td>æ›²ã’åŠå¾„ã®ç¢ºä¿ãŒå¿…è¦ã€ç«¯æœ«å‡¦ç†ã«æ‰‹é–“</td></tr>
                <tr><td>CVT (EM-CET)</td><td>JIS C 3605</td><td>ä¸»å¹¹ç·šã€å¤§è¦æ¨¡ãƒ“ãƒ«</td><td>å˜å¿ƒã‚’æ’šã£ã¦ã„ã‚‹ãŸã‚æ”¾ç†±ãŒè‰¯ãè¨±å®¹é›»æµæœ€å¤§</td><td>ä»•ä¸Šå¤–å¾„ãŒå¤ªãã€é…ç®¡ã‚µã‚¤ã‚ºãŒå¤§ãããªã‚‹</td></tr>
                <tr><td>CVQ</td><td>JIS C 3605</td><td>ä¸‰ç›¸4ç·šå¼ã€3ç›¸+æ¥åœ°ç·š</td><td>4å¿ƒã‚’æ’šã‚Šåˆã‚ã›ã€CV4å¿ƒã‚ˆã‚Šæ”¾ç†±ãŒè‰¯ã„</td><td>CVTã‚ˆã‚Šè¨±å®¹é›»æµã¯ã‚„ã‚„ä½ä¸‹ã™ã‚‹</td></tr>
                <tr><td>VVF (EM-EEF)</td><td>JIS C 3342</td><td>ä½å®…ãƒ»åº—èˆ—ã®åˆ†å²å›è·¯</td><td>å¹³å‹ã§æ–½å·¥æ€§ãŒæ¥µã‚ã¦é«˜ã„ã€å¤©äº•è£ã“ã‚ãŒã—å¯</td><td>è¨±å®¹é›»æµãŒä½ãã€ç‰©ç†çš„è¡æ’ƒã«å¼±ã„</td></tr>
                <tr><td>VVR</td><td>JIS C 3342</td><td>å±‹å†…é…ç·šã€å¼•è¾¼ç·š</td><td>ä¸¸å‹ã§VVFã‚ˆã‚Šå¼·å›ºã€‚é…ç®¡æŒ¿å…¥ã‚‚ã—ã‚„ã™ã„</td><td>VVFã‚ˆã‚Šä»•ä¸Šå¤–å¾„ãŒå¤ªã„</td></tr>
                <tr><td>FP/FPA</td><td>JIS C 3501</td><td>æ¶ˆé˜²è¨­å‚™ç”¨è€ç‡ƒã‚±ãƒ¼ãƒ–ãƒ«</td><td>840â„ƒã§30åˆ†é–“ã®è€ç«æ€§èƒ½ã‚’æŒã¤</td><td>é«˜ä¾¡ã§ã‚ã‚Šã€æ›²ã’ã«ãã„</td></tr>
                <tr><td>MLFC</td><td>-</td><td>é›£ç‡ƒæ€§ãƒãƒªãƒ•ãƒ¬ãƒƒã‚¯ã‚¹</td><td>è€ç†±90-110â„ƒã¨æ¥µã‚ã¦é«˜ãã€æŸ”è»Ÿ</td><td>ä¸»ã«ç›¤å†…ãƒ»æ©Ÿå™¨é…ç·šç”¨ã€‚JISè¦å®šå¤–å¤šã—</td></tr>
            </tbody>
        </table>
    </div>

    <div class="spec-item">
        <h3>2. é›»ç·šç®¡ï¼ˆé…ç®¡ï¼‰ã®ç¨®é¡ã¨ç‰¹æ€§æ¯”è¼ƒ</h3>
        <table class="spec-table">
            <thead>
                <tr><th>ç®¡ç¨®ç•¥ç§°</th><th>JISè¦æ ¼</th><th>åç§°</th><th>ä¸»ãªç”¨é€”</th><th>é•·æ‰€ãƒ»çŸ­æ‰€</th></tr>
            </thead>
            <tbody>
                <tr><td>Gç®¡</td><td>JIS C 8305</td><td>åšé‹¼é›»ç·šç®¡</td><td>å·¥å ´ã€å±‹å¤–ã€ç‰©ç†çš„è¡æ’ƒå ´æ‰€</td><td>æœ€é«˜å¼·åº¦ã€é›»ç£ã‚·ãƒ¼ãƒ«ãƒ‰ã€‚é‡ããƒã‚¸åˆ‡ã‚ŠãŒå¿…è¦ã€‚</td></tr>
                <tr><td>Cç®¡</td><td>JIS C 8330</td><td>è–„é‹¼é›»ç·šç®¡</td><td>ä¸€èˆ¬çš„ãªå±‹å†…é…ç®¡ã€å¤©äº•è£</td><td>Gç®¡ã‚ˆã‚Šè»½é‡ã€‚ãƒã‚¸åˆ‡ã‚Šæ–½å·¥ãŒå¿…è¦ã€‚</td></tr>
                <tr><td>Eç®¡</td><td>JIS C 8305</td><td>ã­ã˜ãªã—é›»ç·šç®¡</td><td>ãƒ“ãƒ«ã€åº—èˆ—ã®å±‹å†…éœ²å‡ºãƒ»éš è”½</td><td>ãƒã‚¸åˆ‡ã‚Šä¸è¦ã§æ–½å·¥ãŒæ—©ã„ã€‚å¼·åº¦ã¯G/Cã«åŠ£ã‚‹ã€‚</td></tr>
                <tr><td>PFç®¡</td><td>JIS C 8411</td><td>åˆæˆæ¨¹è„‚è£½å¯ã¨ã†ç®¡</td><td>äºŒé‡å¤©äº•å†…ã€éš è”½ãƒ»éœ²å‡º</td><td>è‡ªå·±æ¶ˆç«æ€§ãŒã‚ã‚Šéœ²å‡ºå¯ã€‚æ›²ã’ãŒæ¥µã‚ã¦å®¹æ˜“ã€‚</td></tr>
                <tr><td>CDç®¡</td><td>JIS C 8411</td><td>åˆæˆæ¨¹è„‚è£½å¯ã¨ã†ç®¡</td><td>ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆåŸ‹è¾¼å°‚ç”¨</td><td>å®‰ä¾¡ã€è»½é‡ã€‚éè€ç‡ƒæ€§ã€‚éœ²å‡ºå³ç¦ã€‚</td></tr>
                <tr><td>FEPç®¡</td><td>JIS C 3653</td><td>æ³¢ä»˜ãƒãƒªã‚¨ãƒãƒ¬ãƒ³ç®¡</td><td>åœ°ä¸­åŸ‹è¨­å¹¹ç·šï¼ˆãƒãƒ³ãƒ‰ãƒ›ãƒ¼ãƒ«é–“ç­‰ï¼‰</td><td>è»½é‡ã€é•·å°ºã€æ›²ã’ã‚„ã™ã„ã€‚åœ°ä¸­å°‚ç”¨ã€‚</td></tr>
                <tr><td>F2ç®¡</td><td>-</td><td>é›£ç‡ƒæ€§æ³¢ä»˜PEç®¡</td><td>åœ°ä¸­åŸ‹è¨­ã€å»ºç‰©å¼•è¾¼éƒ¨ç­‰</td><td>FEPã®é›£ç‡ƒã‚¿ã‚¤ãƒ—ã€‚éœ²å‡ºéƒ¨ã‚„åŒºç”»è²«é€šã§ä½¿ç”¨ã€‚</td></tr>
            </tbody>
        </table>
    </div>

    <div class="spec-item">
        <h3>3. å†…ç·šè¦ç¨‹ï¼ˆJEAC 8001ï¼‰ã«åŸºã¥ãè¨ˆç®—ãƒ»æ–½å·¥æ¡ä»¶</h3>
        <table class="spec-table">
            <thead>
                <tr><th>é …ç›®</th><th>åŸºæº–å†…å®¹</th><th>æ ¹æ‹ æ¡æ–‡ç­‰</th></tr>
            </thead>
            <tbody>
                <tr><td>é…ç®¡å æœ‰ç‡</td><td>ç•°ãªã‚‹å¤ªã•åå®¹æ™‚32%ä»¥ä¸‹ã€åŒä¸€å¤ªã•48%ä»¥ä¸‹ï¼ˆæœ¬æ©Ÿã¯å®‰å…¨å´ã®32%ã‚’é©ç”¨ï¼‰</td><td>3102-3ç¯€</td></tr>
                <tr><td>é›»åœ§é™ä¸‹</td><td>åˆ†å²å›è·¯ã¯2%ä»¥å†…ã€å¤‰åœ§å™¨ã‹ã‚‰å…¨ä½“ã§3%ä»¥å†…ã‚’æ¨å¥¨</td><td>1310-1ç¯€</td></tr>
                <tr><td>ä¸¦åˆ—æ¥ç¶š</td><td>è¨±å®¹é›»æµã«0.88ã‚’ä¹—ç®—ã€‚åŒä¸€ç·šç¨®ã€åŒä¸€ã‚µã‚¤ã‚ºã€åŒä¸€é•·ã•ã§ã‚ã‚‹ã“ã¨</td><td>1360-11ç¯€</td></tr>
                <tr><td>æ¸©åº¦è£œæ­£</td><td>åŸºæº–30â„ƒã«å¯¾ã—ã€35â„ƒ(0.91), 40â„ƒ(0.82), 45â„ƒ(0.71), 50â„ƒ(0.58)ç­‰ã‚’é©ç”¨</td><td>3103-2è¡¨</td></tr>
                <tr><td>æŸç·šæ¸›å°‘ä¿‚æ•°</td><td>1-3æœ¬(0.70), 4æœ¬(0.63), 5-6æœ¬(0.56), 7-15æœ¬(0.49), 16-40æœ¬(0.43)</td><td>3103-5è¡¨</td></tr>
                <tr><td>é‡‘å±ç®¡æ”¯æŒé–“éš”</td><td>æ”¯æŒç‚¹é–“éš”ã¯2.0mä»¥ä¸‹ã¨ã™ã‚‹ã€‚</td><td>3110-8</td></tr>
                <tr><td>PFç®¡æ”¯æŒé–“éš”</td><td>æ”¯æŒç‚¹é–“éš”ã¯1.5mä»¥ä¸‹ã¨ã™ã‚‹ï¼ˆç®¡æ›²ã’æ™‚ã¯æ›²ãŒã‚Šéƒ¨ä»˜è¿‘ã§å›ºå®šï¼‰ã€‚</td><td>3115-6</td></tr>
                <tr><td>ã‚±ãƒ¼ãƒ–ãƒ«æ”¯æŒ</td><td>é€ å–¶æã«æ²¿ã£ã¦å›ºå®šã™ã‚‹å ´åˆã€æ”¯æŒç‚¹é–“éš”ã¯2.0mä»¥ä¸‹ã¨ã™ã‚‹ã€‚</td><td>3165-4</td></tr>
                <tr><td>æ›²ã’åŠå¾„</td><td>ã‚±ãƒ¼ãƒ–ãƒ«ã®å±ˆæ›²éƒ¨ã¯ã€å¤–å¾„ã®6å€ä»¥ä¸Šï¼ˆå˜å¿ƒã¯8å€ä»¥ä¸Šï¼‰ã‚’ç¢ºä¿ã™ã‚‹ã€‚</td><td>3165-2</td></tr>
            </tbody>
        </table>
    </div>

    <div class="spec-item">
        <h3>4. é›»å‹•æ©Ÿï¼ˆãƒ¢ãƒ¼ã‚¿ãƒ¼ï¼‰å›è·¯ã®è¨­è¨ˆåŸºæº–</h3>
        <table class="spec-table">
            <thead>
                <tr><th>è¨­è¨ˆé …ç›®</th><th>é©ç”¨ãƒ«ãƒ¼ãƒ«</th><th>å‚™è€ƒ</th></tr>
            </thead>
            <tbody>
                <tr><td>é›»ç·šã®è¨±å®¹é›»æµ (Iz)</td><td>ãƒ¢ãƒ¼ã‚¿ãƒ¼å®šæ ¼é›»æµ(Im)ãŒ50Aä»¥ä¸‹ãªã‚‰1.25å€ã€50Aè¶…ãªã‚‰1.1å€ä»¥ä¸Š</td><td>è¦ç¨‹ 3701-2</td></tr>
                <tr><td>é®æ–­å™¨(AT)é¸å®š</td><td>å§‹å‹•é›»æµã‚’è€ƒæ…®ã€‚ä¸€èˆ¬ã« Im Ã— 3å€ä»¥ä¸‹ã‚’é¸å®šã€‚</td><td>è¦ç¨‹ 3701-5</td></tr>
                <tr><td>é›»åœ§é™ä¸‹</td><td>å§‹å‹•æ™‚ã®ä¸€æ™‚çš„ãªé™ä¸‹ã‚’è€ƒæ…®ã—ã€é€šå¸¸æ™‚ã‚ˆã‚Šä½™è£•ã‚’æŒã£ãŸè¨­è¨ˆï¼ˆ2%ä»¥å†…ï¼‰ãŒæœ›ã¾ã—ã„</td><td>å®Ÿå‹™ä¸Šã®æ¨å¥¨</td></tr>
                <tr><td>éè² è·ä¿è­·</td><td>åŸå‰‡ã¨ã—ã¦ãƒ¢ãƒ¼ã‚¿ãƒ¼ã”ã¨ã«éè² è·ä¿è­·è£…ç½®ï¼ˆã‚µãƒ¼ãƒãƒ«ãƒªãƒ¬ãƒ¼ç­‰ï¼‰ã‚’è¨­ã‘ã‚‹ã€‚</td><td>è¦ç¨‹ 3701-4</td></tr>
            </tbody>
        </table>
    </div>

    <div class="summary-box">
        <h4>ğŸ“¢ ã¾ã¨ã‚ï¼šè¨­è¨ˆæ™‚ã«å¿…ãšãƒã‚§ãƒƒã‚¯ã™ã¹ã3å¤§è¦ç¨‹</h4>
        <p><b>3103ï¼ˆè¨±å®¹é›»æµï¼‰:</b> é›»ç·šã®å¤ªã•ãŒç™ºç†±ã«è€ãˆã‚‰ã‚Œã‚‹ã‹ã€‚ï¼ˆæ¸›å°‘ä¿‚æ•°ã®é©ç”¨ãƒŸã‚¹é˜²æ­¢ï¼‰</p>
        <p><b>3110ã€œ3165ï¼ˆæ”¯æŒç‚¹é–“éš”ï¼‰:</b> æ–½å·¥æ™‚ã«å‚ã‚Œä¸‹ãŒã£ãŸã‚Šã€åœ°éœ‡ç­‰ã§ç ´æã—ãŸã‚Šã—ãªã„ã‹ã€‚</p>
        <p><b>3102-7ï¼ˆé˜²ç«è²«é€šï¼‰:</b> é˜²ç«åŒºç”»ã‚’è²«é€šã™ã‚‹éš›ã€èªå®šå·¥æ³•ã§é©åˆ‡ã«å¯†é–‰ã•ã‚Œã¦ã„ã‚‹ã‹ã€‚</p>
    </div>
</div>

<script>
let currentMode = 'kW';
let loadType = 'general';

const db = {
    "CV / EM-CE (90â„ƒ)": [
        {s:"2SQ", a:20, r:9.42, area:113}, {s:"3.5SQ", a:27, r:5.38, area:132}, {s:"5.5SQ", a:36, r:3.42, area:154},
        {s:"8SQ", a:45, r:2.35, area:201}, {s:"14SQ", a:64, r:1.34, area:314}, {s:"22SQ", a:87, r:0.85, area:452},
        {s:"38SQ", a:120, r:0.49, area:660}, {s:"60SQ", a:160, r:0.31, area:907}, {s:"100SQ", a:220, r:0.18, area:1385}
    ],
    "CVT / EM-CET (90â„ƒ)": [
        {s:"8SQ", a:45, r:2.35, area:269, cable:true}, {s:"14SQ", a:64, r:1.34, area:346, cable:true}, 
        {s:"22SQ", a:87, r:0.85, area:452, cable:true}, {s:"38SQ", a:120, r:0.49, area:615, cable:true}, 
        {s:"60SQ", a:160, r:0.31, area:855, cable:true}, {s:"100SQ", a:220, r:0.18, area:1320, cable:true},
        {s:"150SQ", a:290, r:0.12, area:1735, cable:true}, {s:"200SQ", a:345, r:0.09, area:2376, cable:true}
    ],
    "FP / è€ç« (90â„ƒ)": [
        {s:"1.6-2C", a:21, r:8.92, area:122, cable:true}, {s:"1.6-3C", a:18, r:8.92, area:132, cable:true},
        {s:"2.0-2C", a:28, r:5.65, area:145, cable:true}, {s:"2.0-3C", a:24, r:5.65, area:165, cable:true},
        {s:"5.5-3C", a:35, r:3.33, area:280, cable:true}, {s:"8.0-3C", a:42, r:2.31, area:360, cable:true},
        {s:"14-3C", a:60, r:1.30, area:490, cable:true}, {s:"22-3C", a:80, r:0.82, area:680, cable:true}
    ],
    "IV / EM-IE (60/75â„ƒ)": [
        {s:"1.6mm", a:27, r:8.92, area:7.1}, {s:"2.0mm", a:35, r:5.65, area:9.1}, {s:"2.6mm", a:48, r:3.35, area:15.2},
        {s:"5.5SQ", a:49, r:3.33, area:19.6}, {s:"8SQ", a:61, r:2.31, area:28.3}, {s:"14SQ", a:88, r:1.30, area:45.4},
        {s:"22SQ", a:115, r:0.82, area:67.9}, {s:"38SQ", a:162, r:0.48, area:104}, {s:"60SQ", a:217, r:0.30, area:163}
    ],
    "HIV / EM-IC (75â„ƒ)": [
        {s:"1.6mm", a:33, r:8.92, area:7.1}, {s:"2.0mm", a:43, r:5.65, area:9.1}, {s:"5.5SQ", a:58, r:3.33, area:19.6},
        {s:"8SQ", a:72, r:2.31, area:28.3}, {s:"14SQ", a:105, r:1.30, area:45.4}, {s:"22SQ", a:145, r:0.82, area:67.9}
    ],
    "MLFC (110â„ƒ)": [
        {s:"2SQ", a:32, r:9.50, area:15}, {s:"3.5SQ", a:45, r:5.41, area:25}, {s:"5.5SQ", a:58, r:3.44, area:40},
        {s:"8SQ", a:73, r:2.36, area:55}, {s:"14SQ", a:105, r:1.35, area:90}
    ],
    "VVF / VVR (60â„ƒ)": [
        {s:"1.6-2C", a:18, r:8.92, area:100, cable:true}, {s:"1.6-3C", a:15, r:8.92, area:110, cable:true},
        {s:"2.0-2C", a:23, r:5.65, area:120, cable:true}, {s:"2.0-3C", a:20, r:5.65, area:140, cable:true}
    ]
};

const conduitData = {
    "G (åšé‹¼)": { "16":211, "22":366, "28":607, "36":957, "42":1333, "54":2198, "70":3495, "82":4791 },
    "C (è–„é‹¼)": { "19":257, "25":445, "31":716, "39":1122, "51":1893, "63":2951 },
    "E (ã­ã˜ãªã—)": { "19":281, "25":487, "31":774, "39":1195, "51":1995, "63":3088 },
    "PF (å¯ã¨ã†)": { "14":154, "16":201, "22":380, "28":616, "36":1018, "42":1385, "54":2290 },
    "CD (åŸ‹è¾¼å°‚ç”¨)": { "14":154, "16":201, "22":380, "28":616, "36":1018, "42":1385, "54":2290 },
    "FEP (åœ°ä¸­æ³¢ä»˜)": { "30":706, "40":1256, "50":1963, "65":3318, "80":5026, "100":7853 },
    "F2 (é›£ç‡ƒFEP)": { "30":706, "40":1256, "50":1963, "65":3318, "80":5026, "100":7853 }
};

const groundingDb = [
    {at: 20, size: "1.6mm", area:7.1}, {at: 30, size: "2.0mm", area:9.1}, {at: 60, size: "5.5SQ", area:19.6},
    {at: 100, size: "8SQ", area:28.3}, {at: 225, size: "14SQ", area:45.4}, {at: 400, size: "22SQ", area:67.9},
    {at: 600, size: "60SQ", area:163}, {at: 1000, size: "100SQ", area:254}
];

const sysOptions = [
    {v:"12-100", t:"å˜ç›¸2ç·š 100V", cores:2, f:2},
    {v:"13-200", t:"å˜ç›¸3ç·š 200/100V", cores:2, f:1},
    {v:"33-200", t:"ä¸‰ç›¸3ç·š 200V", cores:3, f:1.732},
    {v:"34-400", t:"ä¸‰ç›¸4ç·š 400V/230V", cores:4, f:1}
];

function setLoadType(type) {
    loadType = type;
    document.getElementById('load-gen').classList.toggle('active', type === 'general');
    document.getElementById('load-mot').classList.toggle('active', type === 'motor');
    calculate();
}

function setMode(m) {
    currentMode = m;
    document.querySelectorAll('.mode-btn').forEach(b => { if(b.id.startsWith('btn-')) b.classList.remove('active'); });
    document.getElementById('btn-' + m).classList.add('active');
    calculate();
}

function getBundleFactor(n) {
    if (n <= 3) return 0.70;
    if (n == 4) return 0.63;
    if (n <= 6) return 0.56;
    if (n <= 15) return 0.49;
    return 0.43;
}

function getTempFactor(t) {
    const table = { 30:1.0, 35:0.91, 40:0.82, 45:0.71, 50:0.58 };
    return table[t] || 1.0;
}

function init() {
    const s1 = document.getElementById('sys-type');
    sysOptions.forEach(o => s1.add(new Option(o.t, o.v)));
    const s2 = document.getElementById('wire-cat');
    for(let k in db) s2.add(new Option(k, k));
    const s3 = document.getElementById('conduit-cat');
    for(let k in conduitData) s3.add(new Option(k, k));
    const s4 = document.getElementById('breaker-at');
    [15, 20, 30, 40, 50, 60, 75, 100, 125, 150, 175, 200, 225, 250, 300, 400, 500, 600, 800, 1000].forEach(a => s4.add(new Option(a + " A", a)));
    s4.value = 30;
    updateSizes();
    updateConduitSizes();
}

function syncLength(val, origin) {
    if (origin === 'range') document.getElementById('length-num').value = val;
    else document.getElementById('length-range').value = val;
    document.getElementById('val-length').innerText = val;
    calculate();
}

function updateSizes() {
    const cat = document.getElementById('wire-cat').value;
    const sel = document.getElementById('wire-size');
    sel.innerHTML = '';
    db[cat].forEach((v, i) => sel.add(new Option(v.s, i)));
    calculate();
}

function updateConduitSizes() {
    const cat = document.getElementById('conduit-cat').value;
    const sel = document.getElementById('conduit-size');
    sel.innerHTML = '';
    for(let k in conduitData[cat]) sel.add(new Option(k, k));
    calculate();
}

function switchTab(tab) {
    document.getElementById('calc-view').style.display = tab === 'branch' ? 'grid' : 'none';
    document.getElementById('spec-view').style.display = tab === 'spec' ? 'block' : 'none';
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.id === 'tab-' + tab));
}

function calculate() {
    const sys = sysOptions[document.getElementById('sys-type').selectedIndex];
    const rawValue = parseFloat(document.getElementById('main-input').value) || 0;
    const pf = parseFloat(document.getElementById('pf-percent').value) / 100;
    const breakerAT = parseFloat(document.getElementById('breaker-at').value);
    const catName = document.getElementById('wire-cat').value;
    const wireIndex = document.getElementById('wire-size').value;
    const wire = db[catName][wireIndex];
    const parallelN = parseInt(document.getElementById('parallel-n').value);
    const wireCount = parseInt(document.getElementById('wire-count').value);
    const L = parseFloat(document.getElementById('length-num').value);
    
    // ä¿‚æ•°
    const k_bundle = getBundleFactor(wireCount);
    const k_temp = getTempFactor(document.getElementById('temp').value);
    const k_parallel = parallelN > 1 ? 0.88 : 1.0;
    const k_total = k_bundle * k_temp;

    // 1. è² è·é›»æµ (I)
    let I = 0;
    let v_calc = parseInt(sys.v.split('-')[1]);
    let loadFormula = "";
    if (currentMode === 'A') {
        I = rawValue;
        loadFormula = `ç›´æ¥å…¥åŠ› = <b>${I.toFixed(2)}A</b>`;
    } else {
        let w = currentMode === 'kW' ? rawValue * 1000 : rawValue;
        let root3 = sys.v.startsWith('3') ? 1.732 : 1;
        I = w / (root3 * v_calc * pf);
        loadFormula = `${w}W / (${root3}Ã—${v_calc}VÃ—${pf}) = <b>${I.toFixed(2)}A</b>`;
    }

    // 2. è¨±å®¹é›»æµ (Iz)
    const Iz = wire.a * k_total * parallelN * k_parallel;
    const izFormula = `${wire.a}A(åŸºæœ¬) Ã— ${k_temp.toFixed(2)}(æ¸©) Ã— ${k_bundle.toFixed(2)}(æŸ)${parallelN > 1 ? ` Ã— ${parallelN}æœ¬ Ã— 0.88(ä¸¦)` : ""} = <b>${Iz.toFixed(1)}A</b>`;

    // 3. é›»åœ§é™ä¸‹ (Î”V)
    const R_eff = wire.r / parallelN;
    const deltaV = (sys.f * L * I * R_eff) / 1000;
    const vRate = (deltaV / v_calc) * 100;
    const dvFormula = `(${sys.f}Ã—${L}mÃ—${I.toFixed(2)}AÃ—${R_eff.toFixed(4)}Î©) / 1000 = <b>${deltaV.toFixed(2)}V (${vRate.toFixed(2)}%)</b>`;

    // 4. æ¥åœ°ç·š & å æœ‰ç‡
    const gObj = groundingDb.find(g => g.at >= breakerAT) || groundingDb[groundingDb.length-1];
    let wireTotalArea = wire.cable ? (wire.area * parallelN) : (wire.area * sys.cores * parallelN);
    wireTotalArea += gObj.area;
    const pipeArea = conduitData[document.getElementById('conduit-cat').value][document.getElementById('conduit-size').value];
    const fillRate = (wireTotalArea / pipeArea) * 100;
    const fillFormula = `(é›»ç·š:${wireTotalArea.toFixed(1)}mmÂ² / é…ç®¡:${pipeArea}mmÂ²) Ã— 100 = <b>${fillRate.toFixed(1)}%</b>\nâ€»å†…è¨³: ${wire.cable ? `ã‚±ãƒ¼ãƒ–ãƒ«1æ¡ ${wire.area}mmÂ²` : `å˜å¿ƒç·š ${wire.area}mmÂ²Ã—${sys.cores}èŠ¯`} Ã— ${parallelN}ä¸¦åˆ— + æ¥åœ° ${gObj.area}mmÂ²`;

    // çµæœå‡ºåŠ›
    document.getElementById('res-calc-a').innerText = I.toFixed(2) + " A";
    document.getElementById('res-limit-a').innerText = Iz.toFixed(1) + " A";
    document.getElementById('res-v-rate').innerText = vRate.toFixed(2) + " %";
    document.getElementById('res-fill-rate').innerText = fillRate.toFixed(1) + " %";
    document.getElementById('res-ground-size').innerText = gObj.size;
    document.getElementById('res-k-total').innerText = k_total.toFixed(2);

    // åˆ¤å®š
    const adviceBox = document.getElementById('advice-list');
    let adviceHtml = "";
    let status = "safe";

    if (loadType === 'general') {
        if (I > breakerAT) { status = "danger"; adviceHtml += createAdvice("éè² è·ä¿è­·ä¸å‚™", "è² è·é›»æµãŒATã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚", "é®æ–­å™¨å®šæ ¼ã‚’ä¸Šã’ã¦ãã ã•ã„ã€‚", "danger"); }
        if (breakerAT > Iz) { status = "danger"; adviceHtml += createAdvice("ä¿è­·ä¸é©åˆ", "ATãŒè¨±å®¹é›»æµã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚", "é›»ç·šã‚µã‚¤ã‚ºã‚’å¤§ããã—ã¦ãã ã•ã„ã€‚", "danger"); }
    } else {
        const minIz = I * (I <= 50 ? 1.25 : 1.1);
        if (Iz < minIz) { status = "danger"; adviceHtml += createAdvice("ãƒ¢ãƒ¼ã‚¿ãƒ¼è¦ç¨‹ä¸è¶³", `å†…ç·šè¦ç¨‹ 3701-2 ã«ã‚ˆã‚Š${minIz.toFixed(1)}Aä»¥ä¸Šã®è¨±å®¹é›»æµãŒå¿…è¦ã§ã™ã€‚`, "é›»ç·šã‚µã‚¤ã‚ºã‚’ã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚", "danger"); }
        if (breakerAT > I * 3) { status = "warn"; adviceHtml += createAdvice("é®æ–­å™¨éå¤§", "å§‹å‹•é›»æµã‚’è€ƒæ…®ã—ã¦ã‚‚3å€ä»¥ä¸‹ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚", "ATå®šæ ¼ã‚’ä¸‹ã’ã¦ãã ã•ã„ã€‚", "warn"); }
    }
    if (vRate > 2.0) { if(status !== "danger") status = "warn"; adviceHtml += createAdvice("é›»åœ§é™ä¸‹ã‚ªãƒ¼ãƒãƒ¼", "æ¨å¥¨å€¤2.0%ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚", "é›»ç·šã‚’å¤ªãã™ã‚‹ã‹è·é›¢ã‚’çŸ­ãã—ã¦ãã ã•ã„ã€‚", "warn"); }
    if (fillRate > 32) { if(status !== "danger") status = "warn"; adviceHtml += createAdvice("é…ç®¡å æœ‰ç‡éå¯†", "ç›®æ¨™32%ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚", "é…ç®¡ã‚µã‚¤ã‚ºã‚’å¤§ããã—ã¦ãã ã•ã„ã€‚", "warn"); }

    adviceBox.innerHTML = status === "safe" ? "<div style='color:var(--success); font-weight:bold; padding: 10px; background:#ecfdf5; border-radius:6px;'>âœ… ã™ã¹ã¦ã®åˆ¤å®šåŸºæº–ï¼ˆå†…ç·šè¦ç¨‹ãƒ»JISï¼‰ã«é©åˆã—ã¦ã„ã¾ã™ã€‚</div>" : adviceHtml;
    document.getElementById('status-banner').className = "status-banner " + status;
    document.getElementById('status-banner').innerText = status === "safe" ? "âœ… è¨­è¨ˆé©æ­£" : (status === "warn" ? "âš ï¸ è¨­è¨ˆæ³¨æ„" : "âŒ è¨­è¨ˆä¸é©åˆ");

    document.getElementById('formula-process').innerHTML = `1.è² è·é›»æµ: ${loadFormula}\n2.è¨±å®¹é›»æµ: ${izFormula}\n3.é›»åœ§é™ä¸‹: ${dvFormula}\n4.å æœ‰ç‡: ${fillFormula}`;
}

function createAdvice(title, message, action, type) {
    const borderClass = type === 'danger' ? 'danger-border' : 'warn-border';
    const icon = type === 'danger' ? 'âŒ' : 'âš ï¸';
    return `<div class="advice-item ${borderClass}"><div class="advice-header">${icon} ${title}</div><div class="advice-text">${message} ğŸ”§æ”¹å–„: <b>${action}</b></div></div>`;
}

function switchTab(tab) {
    document.getElementById('calc-view').style.display = tab === 'branch' ? 'grid' : 'none';
    document.getElementById('spec-view').style.display = tab === 'spec' ? 'block' : 'none';
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.id === 'tab-' + tab));
}

init();
</script>
</body>
</html>
